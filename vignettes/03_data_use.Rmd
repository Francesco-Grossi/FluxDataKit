---
title: "Data use"
author: "Koen Hufkens"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data use}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

The (main) data is `rsofun` p-model compatible data. This means that the data
can be used to run the model (and optimizations) as is. We'll include a small
worked example below but refer to the `rsofun` 
[documentation](https://computationales.github.io/rsofun/articles/pmodel_use.html)
for more details.

Take note that not for all sites there is full coverage of the GPP data, these values
are then reported as NA. NA values should be handled per ususal in R and are safely
ignored during model optimization in `rsofun`. For more details on model optimization
we refer to the [vignette in the rsofun package](https://computationales.github.io/rsofun/articles/pmodel_use.html#calibrating-model-parameters).

```{r include=FALSE}
#library(Matrix) # hack because tidyverse bug ffs
library(dplyr)
library(rsofun)

# read in the data, only retain the first two sites for this demo
df <- readRDS("../data/p_model_drivers/site_based_drivers.rds")[1:2,]
```


```{r eval=FALSE}
library(rsofun)
library(dplyr)

# read in the data
df <- readRDS("data/p_model_drivers/site_based_drivers.rds")[1:2,]
```

```{r}
# optimized parameters from previous
# work
params_modl <- list(
    kphio           = 0.09423773,
    soilm_par_a     = 0.33349283,
    soilm_par_b     = 1.45602286,
    tau_acclim_tempstress = 10,
    par_shape_tempstress  = 0.0
  )
```


```{r}
# run the model for these parameters
output <- rsofun::runread_pmodel_f(
  drivers = df,
  par = params_modl,
  makecheck = FALSE
  )

print(output)
```
